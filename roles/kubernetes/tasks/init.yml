---
- name: Generate a token beforehand
  command: kubeadm token generate
  register: token

- name: Reset Kubernetes Master
  command: kubeadm reset

- name: Init the cluster
  command: kubeadm init --token {{ token.stdout }} --pod-network-cidr {{ pod_network_cidr }}
  register: out

- name: Print stdout
  debug:
    var: out

- name: Show token and IP
  debug:
    msg: "Created cluster with token '{{ token.stdout }}'"
